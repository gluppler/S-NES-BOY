# 4.2 PPU Cheatsheets

## System Applicability

**This cheatsheet applies to:**
- ✅ **NES**: Primary focus (Ricoh 2C02 PPU)
- ✅ **Famicom**: Fully compatible (same Ricoh 2C02 PPU)
- ❌ **SNES**: Does not apply (SNES uses different PPU with different registers and capabilities)

**Note**: SNES PPU has different registers, multiple background layers, Mode 7, and enhanced sprite capabilities. This cheatsheet covers NES/Famicom PPU only.

## PPU Register Reference ($2000–$2007)

| Address | Name | Write | Read | Bits |
|---------|------|-------|------|------|
| $2000 | PPUCTRL | Control | — | N N I P P H B M M |
| $2001 | PPUMASK | Mask | — | B G R s b M m G |
| $2002 | PPUSTATUS | — | Status | V S O - - - - - |
| $2003 | OAMADDR | OAM Address | — | A A A A A A A A |
| $2004 | OAMDATA | OAM Data | OAM Data | D D D D D D D D |
| $2005 | PPUSCROLL | Scroll | — | X X X X X X X X |
| $2006 | PPUADDR | Address | — | A A A A A A A A |
| $2007 | PPUDATA | Data | Data | D D D D D D D D |

### $2000 (PPUCTRL) Bit Layout

| Bit | Name | Meaning |
|-----|------|---------|
| 7 | N | NMI enable (1 = enable) |
| 6 | N | Name table select (bit 0) |
| 5 | I | Increment mode (1 = +32, 0 = +1) |
| 4 | P | Pattern table for sprites (1 = $1000, 0 = $0000) |
| 3 | P | Pattern table for background (1 = $1000, 0 = $0000) |
| 2 | H | Sprite size (1 = 8×16, 0 = 8×8) |
| 1 | B | Unused (always 0) |
| 0 | M | Name table select (bit 1) |

**Name Table Selection** (bits 0–1):
- `00` = $2000
- `01` = $2400
- `10` = $2800
- `11` = $2C00

### $2001 (PPUMASK) Bit Layout

| Bit | Name | Meaning |
|-----|------|---------|
| 7 | B | Blue emphasis |
| 6 | G | Green emphasis |
| 5 | R | Red emphasis |
| 4 | s | Show sprites (1 = enable) |
| 3 | b | Show background (1 = enable) |
| 2 | M | Show sprites in left 8px (1 = enable) |
| 1 | m | Show background in left 8px (1 = enable) |
| 0 | G | Grayscale (1 = enable) |

### $2002 (PPUSTATUS) Bit Layout

| Bit | Name | Meaning |
|-----|------|---------|
| 7 | V | VBlank flag (1 = in VBlank) |
| 6 | S | Sprite 0 hit (1 = hit) |
| 5 | O | Sprite overflow (1 = >8 sprites/scanline) |
| 4–0 | — | Unused (open bus) |

**Note**: Reading $2002 clears VBlank flag and address latch.

## Sprite Attribute Byte Layout

| Byte | Offset | Bits | Meaning |
|------|--------|------|---------|
| 0 | Y | 0–7 | Y position (0–239 visible) |
| 1 | Tile | 0–7 | Tile index (pattern table) |
| 2 | Attr | 7 | Vertical flip (1 = flip) |
| 2 | Attr | 6 | Horizontal flip (1 = flip) |
| 2 | Attr | 5 | Priority (0 = front, 1 = behind bg) |
| 2 | Attr | 4–2 | Unused |
| 2 | Attr | 1–0 | Palette (0–3) |
| 3 | X | 0–7 | X position (0–255, wraps) |

**OAM Structure**: 64 sprites × 4 bytes = 256 bytes total

## Palette Memory Layout ($3F00–$3F1F)

| Address | Palette | Color | Usage |
|---------|--------|-------|-------|
| $3F00 | Background 0 | Universal | Background color (mirrored) |
| $3F01 | Background 0 | Color 1 | |
| $3F02 | Background 0 | Color 2 | |
| $3F03 | Background 0 | Color 3 | |
| $3F04 | Background 1 | Color 1 | |
| $3F05 | Background 1 | Color 2 | |
| $3F06 | Background 1 | Color 3 | |
| $3F07 | Background 1 | Color 0 | (mirror of $3F00) |
| $3F08 | Background 2 | Color 1 | |
| $3F09 | Background 2 | Color 2 | |
| $3F0A | Background 2 | Color 3 | |
| $3F0B | Background 2 | Color 0 | (mirror of $3F00) |
| $3F0C | Background 3 | Color 1 | |
| $3F0D | Background 3 | Color 2 | |
| $3F0E | Background 3 | Color 3 | |
| $3F0F | Background 3 | Color 0 | (mirror of $3F00) |
| $3F10 | Sprite 0 | Color 1 | |
| $3F11 | Sprite 0 | Color 2 | |
| $3F12 | Sprite 0 | Color 3 | |
| $3F13 | Sprite 0 | Color 0 | (mirror of $3F00) |
| $3F14 | Sprite 1 | Color 1 | |
| $3F15 | Sprite 1 | Color 2 | |
| $3F16 | Sprite 1 | Color 3 | |
| $3F17 | Sprite 1 | Color 0 | (mirror of $3F00) |
| $3F18 | Sprite 2 | Color 1 | |
| $3F19 | Sprite 2 | Color 2 | |
| $3F1A | Sprite 2 | Color 3 | |
| $3F1B | Sprite 2 | Color 0 | (mirror of $3F00) |
| $3F1C | Sprite 3 | Color 1 | |
| $3F1D | Sprite 3 | Color 2 | |
| $3F1E | Sprite 3 | Color 3 | |
| $3F1F | Sprite 3 | Color 0 | (mirror of $3F00) |

**Note**: $3F00, $3F10, $3F14, $3F18, $3F1C are mirrors of universal background color.

## PPU Memory Map ($0000–$3FFF)

| Address Range | Size | Description |
|--------------|------|-------------|
| $0000–$0FFF | 4 KB | Pattern Table 0 |
| $1000–$1FFF | 4 KB | Pattern Table 1 |
| $2000–$23FF | 1 KB | Name Table 0 |
| $2400–$27FF | 1 KB | Name Table 1 |
| $2800–$2BFF | 1 KB | Name Table 2 |
| $2C00–$2FFF | 1 KB | Name Table 3 |
| $3000–$3EFF | 3.75 KB | Mirrors of $2000–$2EFF |
| $3F00–$3F1F | 32 B | Palette RAM |
| $3F20–$3FFF | 224 B | Mirrors of $3F00–$3F1F |

## Name Table Layout

| Address | Size | Description |
|---------|------|-------------|
| $2000–$23BF | 960 B | Tile map (32×30 tiles) |
| $23C0–$23FF | 64 B | Attribute table (32×30 → 16×15 groups) |

**Attribute Byte Format**: `DDCCBBAA`
- AA: Top-left 2×2 tile group palette (0–3)
- BB: Top-right 2×2 tile group palette (0–3)
- CC: Bottom-left 2×2 tile group palette (0–3)
- DD: Bottom-right 2×2 tile group palette (0–3)

## OAM DMA ($4014)

| Register | Value | Effect |
|----------|-------|--------|
| $4014 | High byte of OAM buffer | Starts DMA transfer |
| Duration | — | 513 CPU cycles |
| Source | $XX00–$XXFF | 256 bytes from CPU RAM |
| Destination | OAM ($2004) | Sprite attribute memory |

**Usage**:
```asm
LDA #0
STA $2003       ; OAM address = 0
LDA #>oam_buffer
STA $4014       ; Start DMA (513 cycles)
```

## Critical Notes

- **$2006 write sequence**: High byte first, then low byte (resets after $2002 read)
- **$2007 first read**: Returns buffered data (invalid), second read is valid
- **VRAM access**: Only safe during VBlank or forced blanking
- **Scroll update**: Must write $2005 twice per frame (X, then Y)
- **Sprite limit**: Maximum 8 sprites per scanline (hardware limit)
- **OAM corruption**: Reading $2002 during rendering can corrupt OAM

## Cross-References

- Related Fundamentals: 1.4 (PPU Fundamentals)
- Related Advanced Fundamentals: 2.3 (PPU Rendering Rules)
- Related Core Concepts: 3.3 (Rendering Architecture)
- Related Cheatsheets: 4.3 (Memory Cheatsheets), 4.4 (Timing Cheatsheets)
