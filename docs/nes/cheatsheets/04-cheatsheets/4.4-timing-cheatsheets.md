# 4.4 Timing Cheatsheets

## System Applicability

**This cheatsheet applies to:
- ✅ **NES: Primary focus
- ✅ **: Fully compatible (same timing)


## NTSC Frame Timing

| Period | Scanlines | CPU Cycles | Duration |
|--------|-----------|------------|----------|
| Visible | 0–239 | ~81,300 | ~15.4 ms |
| Post-render | 240 | ~341 | ~0.19 ms |
| VBlank | 241–260 | ~6,820 | ~3.81 ms |
| Pre-render | 261 | ~341 | ~0.19 ms |
| **Total Frame** | **0–261** | **~89,400** | **~16.67 ms** |
| **Frame Rate** | — | — | **60.098 Hz** |

## PAL Frame Timing

| Period | Scanlines | CPU Cycles | Duration |
|--------|-----------|------------|----------|
| Visible | 0–239 | ~99,600 | ~19.2 ms |
| Post-render | 240 | ~415 | ~0.25 ms |
| VBlank | 241–310 | ~29,100 | ~17.5 ms |
| Pre-render | 311 | ~415 | ~0.25 ms |
| **Total Frame** | **0–311** | **~129,530** | **~20.0 ms** |
| **Frame Rate** | — | — | **50.007 Hz** |

## Scanline Timing (NTSC)

| Scanline Type | CPU Cycles | Duration |
|--------------|------------|----------|
| Visible (0–239) | ~341 | ~190.6 µs |
| Post-render (240) | ~341 | ~190.6 µs |
| VBlank (241–260) | ~341 | ~190.6 µs |
| Pre-render (261) | ~341 | ~190.6 µs |

**Note: Actual cycle count varies slightly (±1 cycle) due to PPU/CPU synchronization.

## Safe VRAM Write Windows

| Period | Safe? | Notes |
|--------|-------|-------|
| Visible (0–239) | ❌ No | PPU is rendering, writes cause corruption |
| Post-render (240) | ⚠️ Risky | Sometimes safe, not recommended |
| VBlank (241–260) | ✅ Yes | Primary safe window |
| Pre-render (261) | ⚠️ Risky | Sometimes safe, not recommended |
| Forced Blanking | ✅ Yes | Rendering disabled via $2001 |

**VBlank Duration:
- NTSC: ~2,270 CPU cycles (~1.27 ms)
- PAL: ~3,270 CPU cycles (~1.97 ms)

## OAM DMA Timing

| Operation | Cycles | Notes |
|-----------|--------|-------|
| OAM DMA ($4014) | 513 | Blocks CPU during transfer |
| Manual OAM Write | 2 per byte | Via $2003/$2004 |

**Maximum OAM Updates per VBlank:
- NTSC: 1 OAM DMA (513 cycles) + ~880 bytes manual (theoretical)
- PAL: 1 OAM DMA (513 cycles) + ~1,380 bytes manual (theoretical)

## VRAM Write Timing

| Operation | Cycles | Notes |
|-----------|--------|-------|
| Set PPU Address ($2006) | 2 × 2 = 4 | High byte, then low byte |
| Write PPU Data ($2007) | 2 per byte | Auto-increments address |
| Read PPU Data ($2007) | 2 per byte | First read is buffered (invalid) |

**Maximum VRAM Writes per VBlank:
- NTSC: ~1,135 bytes (theoretical, ~2,270 cycles ÷ 2)
- PAL: ~1,635 bytes (theoretical, ~3,270 cycles ÷ 2)

## Scroll Update Timing

| Operation | Cycles | Notes |
|-----------|--------|-------|
| Write $2005 (X scroll) | 2 | First write |
| Write $2005 (Y scroll) | 2 | Second write |
| **Total** | **4** | Must be done every frame |

## Controller Read Timing

| Operation | Cycles | Notes |
|-----------|--------|-------|
| Strobe (write $4016) | 2 × 2 = 4 | Write 1, then 0 |
| Read button | 2 per button | Read $4016/$4017 bit 0 |
| **Total (8 buttons)** | **20** | Strobe + 8 reads |

## Audio Update Timing

| Operation | Cycles | Notes |
|-----------|--------|-------|
| Write APU register | 2 per register | Standard register write |
| Frame counter init | 2 | Write $4017 |
| DMC DMA | 4 per sample byte | Steals CPU cycles |

**DMC DMA Impact:
- Max rate (33.5 kHz): ~28% CPU time
- Typical rate (4.18 kHz): ~3.5% CPU time

## Critical Timing Windows

| Window | Start | End | Purpose |
|--------|-------|-----|---------|
| VBlank (NTSC) | Scanline 241 | Scanline 260 | VRAM access |
| VBlank (PAL) | Scanline 241 | Scanline 310 | VRAM access |
| NMI | Start of VBlank | End of NMI handler | Rendering updates |
| Frame Counter | Start of frame | End of frame | Audio updates |

## Cycle Budget per Frame (NTSC)

| Task | Cycles | Percentage |
|------|--------|------------|
| Total frame | ~89,400 | 100% |
| VBlank | ~6,820 | 7.6% |
| Safe VRAM window | ~2,270 | 2.5% |
| Main loop | ~82,580 | 92.4% |

## Critical Notes

- **Frame rate: 60.098 Hz (NTSC), 50.007 Hz (PAL) — not exactly 60/50
- **VBlank duration: ~2,270 cycles (NTSC), ~3,270 cycles (PAL)
- **NMI handler: Must complete in < ~2,000 cycles (leave buffer)
- **OAM DMA: 513 cycles, blocks CPU during transfer
- **VRAM writes: Only during VBlank or forced blanking
- **Scroll updates: Must be done every frame in NMI

## Cross-References

- Related Fundamentals: 1.1 (NES System Overview)
- Related Advanced Fundamentals: 2.1 (CPU Timing & Cycles), 2.2 (NMI & VBlank Discipline), 2.3 (PPU Rendering Rules)
- Related Core Concepts: 3.1 (Game Loop), 3.3 (Rendering Architecture)
- Related Cheatsheets: 4.1 (CPU Cheatsheets), 4.2 (PPU Cheatsheets)
