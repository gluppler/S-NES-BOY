# 2.6 DMG vs CGB Differences

## System Applicability

**This document applies to:**
- ✅ **Game Boy (DMG): Primary focus
- ✅ **Game Boy Color (CGB): Differences explicitly labeled
- ❌ **NES/SNES: Does not apply

## Physical Hardware Overview

The Game Boy Color (CGB) is backward compatible with the original Game Boy (DMG) but includes enhancements:

* **CPU Speed: 4.19 MHz (DMG) vs 8.39 MHz (CGB, double-speed mode)
* **Colors: Monochrome (DMG) vs 32,768 colors (CGB)
* **WRAM: 8 KB (DMG) vs 32 KB (CGB, banked)
* **VRAM: 8 KB (DMG) vs 16 KB (CGB, banked)
* **Palettes: Fixed (DMG) vs programmable (CGB)
* **Joypad Interrupt: Not available (DMG) vs available (CGB)

## Game Boy Terminology Definitions

* **DMG: Original Game Boy (Dot Matrix Game, monochrome)
* **CGB: Game Boy Color (enhanced hardware, backward compatible)
* **Double-Speed Mode: CGB mode running at 8.39 MHz
* **CGB Flag: Cartridge header byte indicating CGB features
* **Backward Compatibility: CGB can run DMG games

## Core Rules and Invariants

### Hardware Differences

| Feature | DMG | CGB |
|---------|-----|-----|
| CPU Speed | 4.19 MHz | 4.19 MHz (normal) / 8.39 MHz (double-speed) |
| Colors | 4 shades of gray | 32,768 colors (15-bit RGB) |
| WRAM | 8 KB (fixed) | 32 KB (8 banks, switchable) |
| VRAM | 8 KB (fixed) | 16 KB (2 banks, switchable) |
| Palettes | Fixed (4 shades) | Programmable (8 palettes) |
| Joypad Interrupt | No | Yes |
| Boot ROM | DMG boot ROM | CGB boot ROM (enhanced) |

### CGB-Only Features

* **VRAM Banking: Switch between two 8 KB VRAM banks
* **WRAM Banking: Switch between 8 WRAM banks (4 KB each)
* **Color Palettes: 8 background palettes, 8 sprite palettes
* **Double-Speed Mode: CPU runs at 2× speed
* **Joypad Interrupt: Hardware interrupt on button press

### Backward Compatibility

* **DMG Games on CGB: Run in DMG mode (monochrome, 4.19 MHz)
* **CGB Games on DMG: May not work (CGB features required)
* **CGB Flag: Cartridge header indicates CGB features needed

## Minimal Correct Usage Example

```asm
; Detect CGB
detect_cgb:
    ld a, [rKEY1]
    bit 7, a        ; Double-speed mode bit
    jr nz, .cgb
    ; DMG mode
    ret
.cgb:
    ; CGB mode
    ret
```

## Gold Standard Example

```asm
; Complete DMG vs CGB handling example
SECTION "Code", ROM0[$0150]

; Detect CGB hardware
detect_cgb:
    ; Per Pan Docs: Check CGB flag in cartridge header
    ; Or check hardware register
    ld a, [rKEY1]
    bit 7, a        ; Double-speed mode available?
    jr nz, .is_cgb
    
    ; DMG hardware
    xor a
    ld [w_is_cgb], a
    ret
    
.is_cgb:
    ; CGB hardware
    ld a, 1
    ld [w_is_cgb], a
    ret

; Initialize based on hardware
init_hardware:
    call detect_cgb
    ld a, [w_is_cgb]
    or a
    jr z, .init_dmg
    
    ; CGB initialization
    call init_cgb
    ret
    
.init_dmg:
    ; DMG initialization
    call init_dmg
    ret

; DMG initialization
init_dmg:
    ; DMG-specific setup
    ; Fixed palettes, 8 KB WRAM, 8 KB VRAM
    ret

; CGB initialization
init_cgb:
    ; CGB-specific setup
    ; Programmable palettes, 32 KB WRAM, 16 KB VRAM
    
    ; Initialize color palettes
    call init_cgb_palettes
    
    ; Set VRAM bank 0
    xor a
    ld [rVBK], a
    
    ; Set WRAM bank 1
    ld a, 1
    ld [rSVBK], a
    
    ret

; Initialize CGB palettes
init_cgb_palettes:
    ; Per Pan Docs: CGB has 8 background and 8 sprite palettes
    ; Each palette has 4 colors (15-bit RGB)
    
    ; Initialize background palette 0
    ld a, $80 | 0   ; Auto-increment, palette 0
    ld [rBCPS], a
    ld a, $00       ; Color 0: Black
    ld [rBCPD], a
    ld a, $00
    ld [rBCPD], a
    ld a, $FF       ; Color 1: White
    ld [rBCPD], a
    ld a, $7F
    ld [rBCPD], a
    
    ; Initialize sprite palette 0
    ld a, $80 | 0   ; Auto-increment, palette 0
    ld [rOCPS], a
    ld a, $00       ; Color 0: Transparent
    ld [rOCPD], a
    ld a, $00
    ld [rOCPD], a
    ld a, $FF       ; Color 1: White
    ld [rOCPD], a
    ld a, $7F
    ld [rOCPD], a
    
    ret

; Switch VRAM bank (CGB only)
switch_vram_bank:
    ld a, [w_is_cgb]
    or a
    ret z           ; DMG has no VRAM banking
    
    ; Switch to VRAM bank 1
    ld a, 1
    ld [rVBK], a
    
    ret

; Switch WRAM bank (CGB only)
switch_wram_bank:
    ld a, [w_is_cgb]
    or a
    ret z           ; DMG has no WRAM banking
    
    ; Switch to WRAM bank 2
    ld a, 2
    ld [rSVBK], a
    
    ret
```

## Validation Rules

### CGB Feature Usage

1. **Hardware Detection: Must detect CGB before using CGB features
2. **Backward Compatibility: DMG games must work on CGB
3. **CGB Flag: Cartridge header must indicate CGB features
4. **Feature Gating: CGB features must be conditionally enabled

### Failure Modes

* **CGB Features on DMG: Game crashes or doesn't work on DMG
* **Missing Detection: Assuming CGB when running on DMG
* **Wrong Bank Switching: Accessing wrong VRAM/WRAM bank
* **Palette Assumptions: Assuming programmable palettes on DMG

## Cross-References

- Related Fundamentals: 1.1 (Game Boy System Overview), 1.3 (Memory Fundamentals)
- Related Advanced Fundamentals: 2.2 (LCD Controller Modes)
- Related Core Concepts: 3.2 (Rendering Pipeline)
